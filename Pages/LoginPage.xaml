<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="Cashere.Pages.LoginPage"
             BackgroundColor="{DynamicResource PageBackgroundColor}"
             x:DataType="pageModels:LoginPageModel"
             xmlns:pageModels="clr-namespace:Cashere.PageModels">

    <Grid>
        <!-- Animated Background Gradient -->
        <BoxView>
            <BoxView.Background>
                <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                    <GradientStop Color="#667eea" Offset="0.0" />
                    <GradientStop Color="#764ba2" Offset="1.0" />
                </LinearGradientBrush>
            </BoxView.Background>
        </BoxView>

        <!-- Main Content -->
        <ScrollView VerticalOptions="Center" HorizontalOptions="Center">
            <Grid WidthRequest="450" Padding="20">
                <Border StrokeThickness="0"
                       StrokeShape="RoundRectangle 30"
                       BackgroundColor="{DynamicResource CardBackgroundColor}">
                    <Border.Shadow>
                        <Shadow Brush="#40000000" Offset="0,10" Radius="30" Opacity="0.5"/>
                    </Border.Shadow>

                    <Grid RowDefinitions="Auto,*" Padding="0">

                        <!-- Header Section -->
                        <Border Grid.Row="0"
                               StrokeThickness="0"
                               StrokeShape="RoundRectangle 30,30,0,0"
                               Padding="40,40,40,30">
                            <Border.Background>
                                <LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
                                    <GradientStop Color="#667eea" Offset="0.0" />
                                    <GradientStop Color="#764ba2" Offset="1.0" />
                                </LinearGradientBrush>
                            </Border.Background>

                            <StackLayout Spacing="15">
                                <Border WidthRequest="80" HeightRequest="80" StrokeThickness="0"
                                       StrokeShape="RoundRectangle 40"
                                       BackgroundColor="#FFFFFF30"
                                       HorizontalOptions="Center">
                                    <Label Text="☕" FontSize="48" HorizontalOptions="Center" VerticalOptions="Center"/>
                                </Border>

                                <Label Text="Cashere POS" FontSize="32" FontAttributes="Bold" TextColor="White" HorizontalTextAlignment="Center"/>
                                <Label Text="Sign in to continue" FontSize="16" TextColor="#FFFFFF90" HorizontalTextAlignment="Center"/>
                            </StackLayout>
                        </Border>

                        <!-- Form Section -->
                        <StackLayout Grid.Row="1" Padding="40,30,40,40" Spacing="25">

                            <!-- Username -->
                            <StackLayout Spacing="8">
                                <Label Text="Username" FontSize="14" FontAttributes="Bold" TextColor="{DynamicResource PrimaryTextColor}"/>
                                <Border BackgroundColor="{DynamicResource PageBackgroundColor}"
                                       StrokeThickness="2" Stroke="{DynamicResource BorderColor}" StrokeShape="RoundRectangle 12">
                                    <Grid ColumnDefinitions="Auto,*" Padding="15,0" ColumnSpacing="10">
                                        <Label Grid.Column="0" Text="👤" FontSize="20" VerticalOptions="Center" Opacity="0.6"/>
                                        <Entry Grid.Column="1"
                                               Text="{Binding Username}"
                                               Placeholder="Enter your username"
                                               PlaceholderColor="{DynamicResource TertiaryTextColor}"
                                               TextColor="{DynamicResource PrimaryTextColor}"
                                               FontSize="15"
                                               BackgroundColor="Transparent"
                                               VerticalOptions="Center"/>
                                    </Grid>
                                </Border>
                            </StackLayout>

                            <!-- Password Field -->
                            <StackLayout Spacing="8">
                                <Grid ColumnDefinitions="*,Auto">
                                    <Label Grid.Column="0"
                                           Text="Password" 
                                           FontSize="14" 
                                           FontAttributes="Bold"
                                           TextColor="{DynamicResource PrimaryTextColor}"/>
                                    <Label Grid.Column="1"
                                           Text="Forgot?"
                                           FontSize="12"
                                           TextColor="#667eea"
                                           TextDecorations="Underline">
                                        <Label.GestureRecognizers>
                                            <TapGestureRecognizer Command="{Binding ForgotPasswordCommand}"/>
                                        </Label.GestureRecognizers>
                                    </Label>
                                </Grid>

                                <Border BackgroundColor="{DynamicResource PageBackgroundColor}"
                                       StrokeThickness="2"
                                       Stroke="{DynamicResource BorderColor}"
                                       StrokeShape="RoundRectangle 12">
                                    <Grid ColumnDefinitions="Auto,*,Auto" 
                                          Padding="15,0"
                                          ColumnSpacing="10">
                                        <Label Grid.Column="0" 
                                               Text="🔒" 
                                               FontSize="20" 
                                               VerticalOptions="Center"
                                               Opacity="0.6"/>
                                        <Entry Grid.Column="1"
                                               Text="{Binding Password}"
                                               Placeholder="Enter your password" 
                                               PlaceholderColor="{DynamicResource TertiaryTextColor}"
                                               TextColor="{DynamicResource PrimaryTextColor}"
                                               IsPassword="{Binding IsPasswordHidden}"
                                               FontSize="15"
                                               BackgroundColor="Transparent"
                                               VerticalOptions="Center"/>
                                        <Label Grid.Column="2"
                                               Text="{Binding IsPasswordHidden, Converter={StaticResource BoolToTextConverter}, ConverterParameter='👁️|👁️‍🗨️'}"
                                               FontSize="20"
                                               VerticalOptions="Center">
                                            <Label.GestureRecognizers>
                                                <TapGestureRecognizer Command="{Binding TogglePasswordVisibilityCommand}"/>
                                            </Label.GestureRecognizers>
                                        </Label>
                                    </Grid>
                                </Border>
                            </StackLayout>

                            <!-- Remember Me -->
                            <Grid ColumnDefinitions="Auto,*" ColumnSpacing="10">
                                <CheckBox Grid.Column="0" 
                                         IsChecked="{Binding RememberMe}"
                                         Color="#667eea"/>
                                <Label Grid.Column="1" 
                                       Text="Remember me" 
                                       FontSize="14"
                                       TextColor="{DynamicResource SecondaryTextColor}"
                                       VerticalOptions="Center"/>
                            </Grid>

                            <!-- Login Button -->
                            <Button Text="Sign In"
                                    FontSize="18"
                                    FontAttributes="Bold"
                                    TextColor="White"
                                    CornerRadius="12"
                                    Padding="0,15"
                                    Margin="0,10,0,0"
                                    Command="{Binding LoginCommand}"
                                    IsEnabled="{Binding IsNotLoading}">
                                <Button.Background>
                                    <LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
                                        <GradientStop Color="#667eea" Offset="0.0" />
                                        <GradientStop Color="#764ba2" Offset="1.0" />
                                    </LinearGradientBrush>
                                </Button.Background>
                            </Button>

                            <!-- Loading -->
                            <Border IsVisible="{Binding IsLoading}" BackgroundColor="#667eea" StrokeThickness="0" StrokeShape="RoundRectangle 12" Padding="0,15">
                                <Grid ColumnDefinitions="Auto,*" ColumnSpacing="10">
                                    <ActivityIndicator Grid.Column="0" IsRunning="True" Color="White" WidthRequest="24" HeightRequest="24"/>
                                    <Label Grid.Column="1" Text="Signing in..." FontSize="16" FontAttributes="Bold" TextColor="White" VerticalOptions="Center"/>
                                </Grid>
                            </Border>

                            <!-- Footer -->
                            <StackLayout Spacing="10" Margin="0,15,0,0">
                                <Label HorizontalTextAlignment="Center" FontSize="13" TextColor="{DynamicResource SecondaryTextColor}">
                                    <Label.FormattedText>
                                        <FormattedString>
                                            <Span Text="Don't have an account? "/>
                                            <Span Text="Contact Admin" TextColor="#667eea" FontAttributes="Bold" TextDecorations="Underline"/>
                                        </FormattedString>
                                    </Label.FormattedText>
                                    <Label.GestureRecognizers>
                                        <TapGestureRecognizer Command="{Binding ContactAdminCommand}"/>
                                    </Label.GestureRecognizers>
                                </Label>

                                <Label Text="Version 1.0.0" FontSize="11" TextColor="{DynamicResource TertiaryTextColor}" HorizontalTextAlignment="Center" Opacity="0.6"/>
                            </StackLayout>
                        </StackLayout>
                    </Grid>
                </Border>
            </Grid>
        </ScrollView>

        <!-- Theme Toggle -->
        <Button Text="{Binding ThemeIcon}"
                FontSize="24"
                BackgroundColor="#FFFFFF30"
                TextColor="White"
                BorderWidth="2"
                BorderColor="#FFFFFF50"
                CornerRadius="25"
                WidthRequest="50"
                HeightRequest="50"
                HorizontalOptions="End"
                VerticalOptions="Start"
                Margin="20"
                Command="{Binding ToggleThemeCommand}"/>

        <!-- API Status Indicator (Android only) -->
        <Frame WidthRequest="14" HeightRequest="14"
               CornerRadius="7"
               BackgroundColor="{Binding ApiStatusColor}"
               BorderColor="#FFFFFF40"
               HasShadow="False"
               HorizontalOptions="Start"
               VerticalOptions="Start"
               Margin="25,25,0,0"
               IsVisible="{Binding IsAndroid}">
            <Label Text="{Binding ApiStatus}"
                   FontSize="10"
                   TextColor="White"
                   Margin="18,0,0,0"
                   VerticalOptions="Center"
                   HorizontalOptions="Start"/>
        </Frame>
    </Grid>
</ContentPage>
